<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Monitor - ZelAPI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border: none;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            border-radius: 12px 12px 0 0 !important;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online {
            background-color: #28a745;
            box-shadow: 0 0 5px #28a745;
        }
        .status-offline {
            background-color: #dc3545;
            box-shadow: 0 0 5px #dc3545;
        }
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .last-update {
            font-size: 0.85rem;
            color: #6c757d;
            font-style: italic;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .metric-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .error-message {
            display: none;
            color: #dc3545;
            text-align: center;
            padding: 20px;
            background-color: #f8d7da;
            border-radius: 8px;
            margin: 20px 0;
        }
        .routes-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .route-item {
            padding: 5px 10px;
            border-bottom: 1px solid #eee;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .route-item:nth-child(even) {
            background-color: #f8f9fa;
        }
        .progress {
            height: 8px;
            border-radius: 4px;
        }
        .auto-refresh-toggle {
            position: fixed;
            bottom: 90px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-0"><i class="bi bi-activity me-2"></i>API Monitor - ZelAPI</h1>
                    <p class="mb-0 mt-2">Memantau status dan kinerja API ZelAPI</p>
                </div>
                <div class="col-md-4 text-end">
                    <div id="mainStatus" class="d-flex align-items-center justify-content-end">
                        <span class="status-indicator status-offline"></span>
                        <span>Memeriksa status...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Memuat data API...</p>
        </div>

        <div class="error-message" id="errorMessage">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span id="errorText">Terjadi kesalahan saat memuat data API.</span>
        </div>

        <div class="row" id="apiData" style="display: none;">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-speedometer2 me-2"></i>Informasi Status</span>
                        <span class="badge bg-primary" id="statusCode">-</span>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="metric-value" id="statusValue">-</div>
                                <div class="metric-label">Status</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value" id="domainValue">-</div>
                                <div class="metric-label">Domain</div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="metric-value" id="requestValue">-</div>
                                <div class="metric-label">Total Request</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value" id="featureValue">-</div>
                                <div class="metric-label">Total Fitur</div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="metric-value" id="runtimeValue">-</div>
                                <div class="metric-label">Runtime</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value" id="speedValue">-</div>
                                <div class="metric-label">Kecepatan</div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="metric-value" id="regionValue">-</div>
                                <div class="metric-label">Region</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value" id="creatorValue">-</div>
                                <div class="metric-label">Creator</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <span><i class="bi bi-cpu me-2"></i>Performa Server</span>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>Success Rate</span>
                                <span id="successRateValue">-</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar bg-success" role="progressbar" id="successRateBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>Error Rate</span>
                                <span id="errorRateValue">-</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar bg-danger" role="progressbar" id="errorRateBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>RAM Usage</span>
                                <span id="ramUsageValue">-</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar bg-info" role="progressbar" id="ramUsageBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-value" id="cpuLoadValue">-</div>
                                <div class="metric-label">CPU Load</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value" id="bandwidthValue">-</div>
                                <div class="metric-label">Bandwidth</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <span><i class="bi bi-code-slash me-2"></i>Informasi Debug</span>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="metric-value" id="debugTimeValue">-</div>
                                <div class="metric-label">Debug Time</div>
                            </div>
                            <div class="col-md-4">
                                <div class="metric-value" id="totalRoutesValue">-</div>
                                <div class="metric-label">Total Routes</div>
                            </div>
                            <div class="col-md-4">
                                <div class="metric-value" id="loadedFilesValue">-</div>
                                <div class="metric-label">Loaded Files</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <h6>Daftar Route:</h6>
                            <div class="routes-list" id="routesList">
                                <p class="text-center text-muted">Memuat daftar route...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-4 mb-5">
            <p class="last-update">Terakhir diperbarui: <span id="lastUpdate">-</span></p>
        </div>
    </div>

    <div class="auto-refresh-toggle">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="autoRefreshToggle">
            <label class="form-check-label bg-white px-3 py-1 rounded shadow" for="autoRefreshToggle">
                Auto Refresh
            </label>
        </div>
    </div>

    <button class="btn btn-primary refresh-btn" id="refreshBtn">
        <i class="bi bi-arrow-clockwise"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusUrl = 'https://zelapioffciall.koyeb.app/api-status/status';
            const debugUrl = 'https://zelapioffciall.koyeb.app/api-status/debug';
            
            let refreshInterval;
            const autoRefreshToggle = document.getElementById('autoRefreshToggle');
            const refreshBtn = document.getElementById('refreshBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const errorMessage = document.getElementById('errorMessage');
            const apiData = document.getElementById('apiData');
            const lastUpdateElement = document.getElementById('lastUpdate');
            
            // Fungsi untuk memuat data API
            async function loadApiData() {
                showLoading();
                
                try {
                    // Fetch status data
                    const statusResponse = await fetch(statusUrl);
                    if (!statusResponse.ok) {
                        throw new Error(`Status API response error: ${statusResponse.status}`);
                    }
                    const statusData = await statusResponse.json();
                    
                    // Fetch debug data
                    const debugResponse = await fetch(debugUrl);
                    if (!debugResponse.ok) {
                        throw new Error(`Debug API response error: ${debugResponse.status}`);
                    }
                    const debugData = await debugResponse.json();
                    
                    // Update UI dengan data yang didapat
                    updateStatusUI(statusData, debugData);
                    hideLoading();
                    updateLastUpdateTime();
                    
                } catch (error) {
                    console.error('Error loading API data:', error);
                    showError(error.message);
                    hideLoading();
                }
            }
            
            // Fungsi untuk menampilkan loading spinner
            function showLoading() {
                loadingSpinner.style.display = 'block';
                errorMessage.style.display = 'none';
                apiData.style.display = 'none';
            }
            
            // Fungsi untuk menyembunyikan loading spinner
            function hideLoading() {
                loadingSpinner.style.display = 'none';
                apiData.style.display = 'block';
            }
            
            // Fungsi untuk menampilkan error
            function showError(message) {
                document.getElementById('errorText').textContent = message;
                errorMessage.style.display = 'block';
                apiData.style.display = 'none';
                
                // Update main status to offline
                const mainStatus = document.getElementById('mainStatus');
                mainStatus.innerHTML = '<span class="status-indicator status-offline"></span><span>Offline</span>';
            }
            
            // Fungsi untuk memperbarui UI dengan data status
            function updateStatusUI(statusData, debugData) {
                // Update main status
                const mainStatus = document.getElementById('mainStatus');
                const statusIndicator = statusData.status ? 'status-online' : 'status-offline';
                const statusText = statusData.status ? 'Online' : 'Offline';
                mainStatus.innerHTML = `<span class="status-indicator ${statusIndicator}"></span><span>${statusText}</span>`;
                
                // Update status code
                document.getElementById('statusCode').textContent = '200';
                
                // Update status values
                document.getElementById('statusValue').textContent = statusData.result.status;
                document.getElementById('domainValue').textContent = statusData.result.domain;
                document.getElementById('requestValue').textContent = statusData.result.totalrequest;
                document.getElementById('featureValue').textContent = statusData.result.totalfitur;
                document.getElementById('runtimeValue').textContent = statusData.result.runtime;
                document.getElementById('speedValue').textContent = statusData.result.speed;
                document.getElementById('regionValue').textContent = statusData.result.region;
                document.getElementById('creatorValue').textContent = statusData.creator;
                
                // Update performance values
                document.getElementById('successRateValue').textContent = statusData.result.successRate;
                document.getElementById('errorRateValue').textContent = statusData.result.errorRate;
                document.getElementById('ramUsageValue').textContent = `${statusData.result.ramUsed} / ${statusData.result.ramTotal}`;
                document.getElementById('cpuLoadValue').textContent = statusData.result.cpuLoad;
                document.getElementById('bandwidthValue').textContent = statusData.result.bandwidthSent;
                
                // Update progress bars
                const successRate = parseFloat(statusData.result.successRate);
                const errorRate = parseFloat(statusData.result.errorRate);
                const ramUsage = (parseFloat(statusData.result.ramUsed) / parseFloat(statusData.result.ramTotal)) * 100;
                
                document.getElementById('successRateBar').style.width = `${successRate}%`;
                document.getElementById('errorRateBar').style.width = `${errorRate}%`;
                document.getElementById('ramUsageBar').style.width = `${ramUsage}%`;
                
                // Update debug values
                document.getElementById('debugTimeValue').textContent = new Date(debugData.debug_time).toLocaleString();
                document.getElementById('totalRoutesValue').textContent = debugData.total_routes;
                document.getElementById('loadedFilesValue').textContent = debugData.loaded_files.length;
                
                // Update routes list
                const routesList = document.getElementById('routesList');
                routesList.innerHTML = '';
                
                debugData.loaded_files.forEach(route => {
                    const routeItem = document.createElement('div');
                    routeItem.className = 'route-item';
                    routeItem.textContent = route;
                    routesList.appendChild(routeItem);
                });
            }
            
            // Fungsi untuk memperbarui waktu update terakhir
            function updateLastUpdateTime() {
                const now = new Date();
                lastUpdateElement.textContent = now.toLocaleString();
            }
            
            // Event listener untuk tombol refresh
            refreshBtn.addEventListener('click', function() {
                loadApiData();
                
                // Animation effect
                refreshBtn.querySelector('i').classList.add('bi-spin');
                setTimeout(() => {
                    refreshBtn.querySelector('i').classList.remove('bi-spin');
                }, 1000);
            });
            
            // Event listener untuk toggle auto refresh
            autoRefreshToggle.addEventListener('change', function() {
                if (this.checked) {
                    refreshInterval = setInterval(loadApiData, 30000); // Refresh every 30 seconds
                } else {
                    clearInterval(refreshInterval);
                }
            });
            
            // Custom CSS for spin animation
            const style = document.createElement('style');
            style.textContent = `
                .bi-spin {
                    animation: spin 1s infinite linear;
                }
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Load data initially
            loadApiData();
        });
    </script>
</body>
</html>
